---
# yaml-language-server: $schema=https://k8s-schemas.bjw-s.dev/renovate-operator.mogenius.com/renovatejob_v1alpha1.json
apiVersion: renovate-operator.mogenius.com/v1alpha1
kind: RenovateJob
metadata:
  name: webgrip-gitops
spec:
  discoveryFilter: webgrip/*
  # renovate-operator evaluates cron in its controller timezone (typically UTC).
  # Run frequently so Dependency Dashboard approvals take effect quickly.
  schedule: "*/10 * * * *"
  parallelism: 5
  image: docker.io/renovate/renovate:43.4.2-full@sha256:6dafbedb9e4816805affde589187c50af42ed4a4a550086e471d14be5333ba85
  secretRef: renovate-runtime-token
  webhook:
    enabled: true
    authentication:
      enabled: true
      secretRef:
        name: renovate-webhook-auth
        key: token
  extraEnv:
    - name: RENOVATE_PLATFORM
      value: github
    - name: RENOVATE_ENDPOINT
      value: https://api.github.com/
    - name: RENOVATE_CONFIG_FILE
      value: /config/renovate.json
    - name: RENOVATE_BASE_DIR
      value: /tmp/renovate
    - name: LOG_LEVEL
      value: debug
  extraVolumes:
    - name: config
      configMap:
        name: renovate-config-gitops
  extraVolumeMounts:
    - name: config
      mountPath: /config
      readOnly: true
  resources:
    requests:
      cpu: 50m
      memory: 256Mi
    limits:
      memory: 1Gi
  securityContext:
    pod:
      runAsNonRoot: false
      runAsUser: 0
      runAsGroup: 0
    container:
      allowPrivilegeEscalation: false
