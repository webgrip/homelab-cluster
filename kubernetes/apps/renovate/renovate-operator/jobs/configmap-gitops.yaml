---
apiVersion: v1
kind: ConfigMap
metadata:
  name: renovate-config-gitops
data:
  renovate.json: |-
    {
      "$schema": "https://docs.renovatebot.com/renovate-schema.json",
      "extends": [
        "config:recommended",
        ":dependencyDashboard",
        ":labels(dependencies)"
      ],
      "dependencyDashboard": true,
      "automerge": false,

      "platform": "github",
      "autodiscover": true,
      "autodiscoverFilter": ["webgrip/*"],
      "timezone": "UTC",
      "onboarding": true,
      "requireConfig": "optional",

      "vulnerabilityAlerts": {
        "enabled": true,
        "labels": ["security"],
        "schedule": ["at any time"]
      },

      "hostRules": [
        {
          "matchHost": "api.github.com",
          "concurrentRequestLimit": 2,
          "maxRequestsPerSecond": 1
        }
      ],

      "prConcurrentLimit": 5,
      "prHourlyLimit": 1,

      "enabledManagers": [
        "flux",
        "kustomize",
        "helm-values",
        "helmfile"
      ],

      "ignorePaths": [
        "**/*.sops.yaml",
        "**/*.sops.yml",
        "bootstrap/**",
        "talos/**",
        "kubeconfig",
        "github-push-token.txt",
        "github-deploy.key.pub"
      ],

      "packageRules": [
        {
          "matchManagers": ["flux"],
          "groupName": "Flux OCI/Helm updates"
        },
        {
          "matchManagers": ["helm-values", "kustomize", "helmfile"],
          "matchDatasources": ["docker"],
          "groupName": "Container images (GitOps)"
        },
        {
          "matchUpdateTypes": ["major"],
          "addLabels": ["major"],
          "dependencyDashboardApproval": true
        }
      ]
    }
